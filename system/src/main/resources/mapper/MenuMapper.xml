<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sinfeeloo.inventory.mapper.MenuMapper">
    <resultMap id="BaseResultMap" type="com.sinfeeloo.inventory.entity.Menu">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Apr 25 17:12:01 CST 2018.
        -->
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="upId" jdbcType="INTEGER" property="upid"/>
        <result column="path" jdbcType="VARCHAR" property="path"/>
        <result column="isLeaf" jdbcType="INTEGER" property="isleaf"/>
        <result column="state" jdbcType="INTEGER" property="state"/>
        <result column="updater" jdbcType="VARCHAR" property="updater"/>
        <result column="icon" jdbcType="VARCHAR" property="icon"/>
        <result column="updatime" jdbcType="TIMESTAMP" property="updatime"/>
    </resultMap>

    <!--通过名称查询菜单-->
    <select id="selectByNameOrPath" resultMap="BaseResultMap">
    SELECT *
    FROM lz_sys_menu
    WHERE (name=#{name,jdbcType=VARCHAR} OR path = #{path,jdbcType=VARCHAR})
    AND state = 1
  </select>

    <!--通过父菜单id查出所有的子菜单-->
    <select id="selectChildrenMenuByUpId" resultMap="BaseResultMap">
        SELECT *
        FROM lz_sys_menu
        WHERE upId=#{upId,jdbcType=INTEGER}
        AND state = 1
    </select>

    <!--添加菜单-->
    <insert id="insert" parameterType="com.sinfeeloo.inventory.entity.Menu">
        insert into lz_sys_menu (id, name, upId,
        path, isLeaf, state,
        updater, updatime)
        values (#{id,jdbcType=INTEGER}, #{name,jdbcType=VARCHAR}, #{upid,jdbcType=INTEGER},
        #{path,jdbcType=VARCHAR}, #{isleaf,jdbcType=INTEGER}, #{state,jdbcType=INTEGER},
        #{updater,jdbcType=VARCHAR}, now())
    </insert>


    <!--查询所有未删除的菜单-->
    <select id="selectAll" resultMap="BaseResultMap">
        select id, name, upId, path, isLeaf, state, updater, updatime,icon
        from lz_sys_menu
        WHERE state = 1
    </select>

    <!--通过id查询菜单-->
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        select id, name, upId, path, isLeaf, state, updater, updatime,icon
        from lz_sys_menu
        where id = #{id,jdbcType=INTEGER}
        AND state = 1
    </select>

    <!--通过id查询根菜单-->
    <select id="selectRootMenuByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        select id, name, upId, path, isLeaf, state, updater, updatime,icon
        from lz_sys_menu
        where id = #{id,jdbcType=INTEGER}
        AND state = 1
        AND isLeaf = 0
    </select>


    <!--修改-->
    <update id="updateByPrimaryKey" parameterType="com.sinfeeloo.inventory.entity.Menu">
        update lz_sys_menu
        set name = #{name,jdbcType=VARCHAR},
        path = #{path,jdbcType=VARCHAR},
        updater = #{updater,jdbcType=VARCHAR},
        updatime = now()
        where id = #{id,jdbcType=INTEGER}
        AND state = 1
    </update>

    <!--删除-->
    <update id="deleteByPrimaryKey" parameterType="com.sinfeeloo.inventory.entity.Menu">
        update lz_sys_menu
        set state = 0,
        updater = #{updater,jdbcType=VARCHAR},
        updatime = now()
        where id = #{id,jdbcType=INTEGER}
        AND state = 1
    </update>

    <!--查询根节点下面所有的子节点-->
    <select id="selectByUpId" resultMap="BaseResultMap">
        SELECT *
        FROM lz_sys_menu
        WHERE upId = #{upid,jdbcType=INTEGER}
        AND state = 1
    </select>
</mapper>